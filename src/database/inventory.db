# filepath: c:\Users\DELL\Desktop\uni\universidad\p3\Proyecto Final\Proyecto Final-1\src\database\db_manager.py
import os
import sqlite3

class DBManager:
    def __init__(self, db_path):
        self.db_path = db_path
        self._ensure_data_folder_exists()

    def _ensure_data_folder_exists(self):
        """Crea la carpeta 'data' si no existe."""
        folder = os.path.dirname(self.db_path)
        if not os.path.exists(folder):
            os.makedirs(folder)

    def initialize_database(self):
        """Inicializa la base de datos y crea las tablas necesarias."""
        connection = self._connect()
        cursor = connection.cursor()

        # Crear tabla de inventario
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS inventory (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            product_name TEXT NOT NULL,
            quantity INTEGER NOT NULL,
            restock_threshold INTEGER NOT NULL
        )
        """)

        # Crear tabla de eventos
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS events (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            event_type TEXT NOT NULL,
            event_description TEXT NOT NULL,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        )
        """)

        connection.commit()
        connection.close()

    def _connect(self):
        """Establece la conexi√≥n con la base de datos."""
        return sqlite3.connect(self.db_path)